<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.Workneed.workneed.Approval.mapper.LeaveApprovalMapper">



    <insert id="insertLeaveRequest"
            parameterType="com.Workneed.workneed.Approval.dto.LeaveRequestDTO">
        INSERT INTO test.LEAVE_REQUEST
        (approval_doc_id, user_id, leave_type, start_date, end_date, reason, created_at)
        VALUES
        (#{docId}, #{userId}, #{leaveType}, #{startDate}, #{endDate}, #{reason}, NOW())
    </insert>

    <!-- 1) 작성자 부서 -->
    <select id="selectDeptIdByUserId" resultType="long">
        SELECT dept_id
        FROM test.user
        WHERE user_id = #{userId}
    </select>

    <select id="findTeamLeaderId" resultType="long">
        SELECT u.user_id
        FROM test.user u
        JOIN test.Ranks r ON r.rank_id = u.rank_id
        WHERE u.dept_id = #{deptId}
        AND r.rank_name = '차장'
        LIMIT 1
    </select>

    <insert id="insertApprovedLine">
        INSERT INTO test.approval_line (
        approval_doc_id,
        approver_id,
        order_num,
        status,
        approved_at,
        comment
        ) VALUES (
        #{docId},
        #{approverId},
        #{orderNum},
        'APPROVED',
        #{approvedAt},
        null
        )
    </insert>

</mapper>
