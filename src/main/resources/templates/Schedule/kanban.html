<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
    <title>Title</title>
    <th:block layout:fragment="head">
        <link rel="stylesheet" th:href="@{/css/kanban.css}">
        <link rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css}">
    </th:block>
</head>

<body>
<main layout:fragment="content">
    <div class="kanban">
        <div class="kanban-todo">
            <div class="kanban-header">TODO</div>
            <div class="kanban-cards" data-status="TODO">
                <div class="kanban-card" th:each="item : ${todoList}"
                                         th:attr="data-id=${item.scheduleId}"
                                         th:classappend="${item.endAt != null and item.endAt.isBefore(now)} ? 'is-overdue'">
                    <div class="title-event-type">
                        <span class="badge-expired" th:if="${item.endAt != null and item.endAt.isBefore(now)}">
                            기간 만료
                        </span>
                        <div class="title" th:text="${item.title}">Title</div>
                        <div class="event-type" th:text="${item.eventType}">Event Type</div>
                    </div>
                    <div class="date-time">
                        <div class="start-at" th:text="${#temporals.format(item.startAt, 'yyyy-MM-dd HH:mm')}">Start At</div>
                        <div class="end-at" th:text="${#temporals.format(item.endAt, 'yyyy-MM-dd HH:mm')}"> End At</div>
                    </div>
                    <div class="card-desc" th:text="${#strings.abbreviate(item.description, 40)}">Description</div>
                    <div class="image"></div>

                </div>
            </div>
            <button class="kanban-addTask">+ Add Task</button>
        </div>
        <div class="kanban-doing">
            <div class="kanban-header">DOING</div>
            <div class="kanban-cards" data-status="DOING">
                <div class="kanban-card" th:each="item : ${doingList}"
                                         th:attr="data-id=${item.scheduleId}"
                                         th:classappend="${item.endAt != null and item.endAt.isBefore(now)} ? 'is-overdue'">
                    <div class="title-event-type">
                        <span class="badge-expired" th:if="${item.endAt != null and item.endAt.isBefore(now)}">
                            기간 만료
                        </span>
                        <div class="title" th:text="${item.title}">Title</div>
                        <div class="event-type" th:text="${item.eventType}">Event Type</div>
                    </div>
                    <div class="date-time">
                        <div class="start-at" th:text="${#temporals.format(item.startAt, 'yyyy-MM-dd HH:mm')}">Start At</div>
                        <div class="end-at" th:text="${#temporals.format(item.endAt, 'yyyy-MM-dd HH:mm')}"> End At</div>
                    </div>
                    <div class="card-desc" th:text="${#strings.abbreviate(item.description, 40)}">Description</div>
                </div>
            </div>
            <button class="kanban-addTask">+ Add Task</button>
        </div>
        <div class="kanban-done">
            <div class="kanban-header">
                DONE
                <button type="button" class="done-delete-btn" disabled>
                    Delete <span id="doneSelectedCount">[ 0 ]</span>
                </button>
            </div>
            <div class="kanban-cards" data-status="DONE">
                <div class="kanban-card" th:each="item : ${doneList}"
                                         th:attr="data-id=${item.scheduleId}"
                                         th:classappend="${item.endAt != null and item.endAt.isBefore(now)} ? 'is-overdue'">
                    <label class="done-check">
                        <input type="checkbox" class="done-select">
                    </label>
                    <div class="title-event-type">

                        <span class="badge-expired" th:if="${item.endAt != null and item.endAt.isBefore(now)}">
                            기간 만료
                        </span>

                        <div class="title" th:text="${item.title}">Title</div>
                        <div class="event-type" th:text="${item.eventType}">Event Type</div>
                    </div>
                    <div class="date-time">
                        <div class="start-at" th:text="${#temporals.format(item.startAt, 'yyyy-MM-dd HH:mm')}">Start At</div>
                        <div class="end-at" th:text="${#temporals.format(item.endAt, 'yyyy-MM-dd HH:mm')}"> End At</div>
                    </div>
                    <div class="card-desc" th:text="${#strings.abbreviate(item.description, 40)}">Description</div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-backdrop" id="modal-backdrop" hidden></div>

    <div class="modal" id="taskModal" hidden>
        <div class="modal-panel" id="taskModal-panel">

            <header class="modal-header">Add Task</header>
            <button type="button" class="x-btn"> x </button>

            <form class="task-form" id="taskForm" th:action="@{/schedule/create}" method="post" enctype="multipart/form-data">

                <input type="hidden" name="status" id="status" value="TODO" />

                <div class="modal-sheet">

                    <div class="field" id="titleR">
                        <input id="title" name="title" type="text" placeholder="Task title" aria-label="Task title" required />
                    </div>

                    <div class="field" id="dateTimeR">
                        <div class="start">
                            <input id="startAt" name="startAt" type="text"  placeholder="Start At"  aria-label="Start date/time" title="Start date/time" required />
                        </div>
                        <div class="end">
                            <input id="endAt" name="endAt" type="text" placeholder="End At"  aria-label="End date/time" title="End date/time" required />
                        </div>
                    </div>

                    <div class="field" id="locationR">
                        <input id="location" name="location" type="text" placeholder="Location" aria-label="Location"/>
                    </div>

                    <div class="field" id="eventTypeR">
                        <div class="eventTypeGroup" id="eventTypeGroup">
                            <button type="button" class="eventBtn" data-value="PROJECT">Project</button>
                            <button type="button" class="eventBtn" data-value="TASK">Task</button>
                            <button type="button" class="eventBtn" data-value="MEETING">Meeting</button>
                            <button type="button" class="eventBtn" data-value="REVIEW">Review</button>
                            <button type="button" class="eventBtn" data-value="EVENT">Event</button>
                            <button type="button" class="eventBtn" data-value="REPORT">Report</button>
                            <button type="button" class="eventBtn" data-value="Issue">Issue</button>
                            <button type="button" class="eventBtn" data-value="ETC">ETC</button>
                        </div>
                        <input type="hidden" id="eventType" name="eventType" value="PROJECT" />
                    </div>

                    <div class="field" id="typeR">
                        <div class="typeGroup" id="typeGroup">
                            <button type="button" class="scope-btn" data-value="PERSONAL">
                                <span class="scope-icon"><img src="/images/person300.svg"></span>
                                <span class="scope-txt">PERSONAL</span>
                            </button>
                            <button type="button" class="scope-btn" data-value="TEAM">
                                <span class="scope-icon"><img src="/images/team2_300.svg"></span>
                                <span class="scope-txt">TEAM</span>
                            </button>
                            <button type="button" class="scope-btn" data-value="COMPANY">
                                <span class="scope-icon"><img src="/images/company300.svg"></span>
                                <span class="scope-txt">COMPANY</span>
                            </button>
                        </div>
                        <input type="hidden" id="type" name="type" value="PERSONAL" />
                    </div>

                    <div class="field" id="descriptionR">
                        <textarea id="description" name="description" rows="8" placeholder="Task description" aria-label="Task description"></textarea>
                    </div>

                </div>

                <div class="modal-btns">
                    <button class="btn" type="submit" id="okBtn">확인</button>
                    <button class="btn" type="button" id="cancelBtn">취소</button>
                </div>

            </form>

        </div>
    </div>


    <div class="modal" id="teamModal" hidden>
        <div class="modal-panel" id="teamModal-panel" style="width: 750px;">
            <header class="modal-header">팀원 초대 (조직도)</header>
            <button type="button" class="x-btn"> x </button>

            <form id="teamInviteForm">
                <input type="hidden" id="teamScheduleId" name="scheduleId" />

                <div class="modal-body-main" style="display: flex; height: 450px; border: 1px solid #eee;">
                    <div class="selection-panel" style="width: 50%; border-right: 1px solid #eee; overflow-y: auto; padding: 15px;">
                        <div class="search-box" style="margin-bottom: 10px;">
                            <input type="text" id="userSearchInput" placeholder="이름 검색" style="width: 100%; padding: 8px;">
                        </div>
                        <div id="deptTreeContainer" class="dept-list-container">
                        </div>
                    </div>

                    <div class="selected-panel" style="width: 50%; padding: 15px; background: #fafafa; overflow-y: auto;">
                        <div id="selectedUsersCount" style="font-weight: bold; margin-bottom: 10px;">선택된 대상 (0)</div>
                        <div id="selectedUserList">
                            <p class="placeholder-text">대상을 선택해주세요.</p>
                        </div>
                    </div>
                </div>

                <div class="modal-btns">
                    <button class="btn" type="submit" id="submitInviteBtn">초대하기</button>
                    <button class="btn" type="button" onclick="closeTeamModal()">취소</button>
                </div>
            </form>
        </div>
    </div>

</main>

<th:block layout:fragment="script">
    <!-- 드래그 이동 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
    <!-- 시간 JS    -->
    <script th:src="@{https://cdn.jsdelivr.net/npm/flatpickr}"></script>
    <script th:src="@{/js/kanban.js}"></script>
</th:block>

</body>
</html>