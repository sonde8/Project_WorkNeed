<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Main</title>

    <script th:inline="javascript">
        /*<![CDATA[*/
        window.passwordChangeError = [[${passwordChangeError != null}]];
        /*]]>*/
    </script>

    <script src="/js/main.js"></script>
</head>
<body>

<h1>메인 페이지</h1>

<!-- 비로그인 -->
<div th:if="${user == null}">
    <a href="/login">로그인</a>
    <a href="/register">회원가입</a>
</div>

<!-- 로그인 -->
<div th:if="${user != null}">

    <!-- 임시용 프로필 이미지 -->
    <img th:src="${user.userProfileImage != null
                     ? user.userProfileImage
                     : '/images/default-profile.png'}"
         alt="프로필 이미지"
         width="120"
         height="120"
         style="border-radius: 50%; object-fit: cover;"/>

    <p th:text="${user.userName} + ' 님 환영합니다'"></p>

    <form action="/logout" method="post">
        <button type="submit">로그아웃</button>
    </form>

    <button id="openPwModal" type="button">비밀번호 변경</button>
</div>

<!-- 비밀번호 변경 모달 -->
<div th:if="${user != null}">
    <div id="pwModal" style="display:none;">
        <form method="post" action="/my/password/change">
            <input type="password" name="currentPassword" placeholder="현재 비밀번호">
            <input type="password" name="newPassword" placeholder="새 비밀번호">
            <input type="password" name="confirmPassword" placeholder="새 비밀번호 확인">
            <button type="submit">확인</button>
        </form>

        <p th:if="${passwordChangeError}"
           th:text="${passwordChangeError}"
           style="color:red;"></p>
    </div>
</div>


<!--소셜 프로필 이미지 연동버튼,연동여부-->
<div th:if="${user != null}">
    <hr>
    <h3>소셜 계정 연동 (테스트)</h3>

    <!-- Google 연동 버튼 -->
    <a href="/auth/google/link">
        <button type="button">Google 계정 연동</button>
    </a>

    <!-- 연동 상태 표시 (나중에) -->
    <!--
    <p>Google 계정 연동됨</p>
    -->
</div>

</body>
</html>
