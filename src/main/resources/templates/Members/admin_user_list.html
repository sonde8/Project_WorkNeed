<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>관리자 - 직원관리 </title>
    <link rel="stylesheet" th:href="@{/css/admin_user_list.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div class="admin-header" th:if="${admin != null}">
    <span>관리자: <b th:text="${admin.adminName}">관리자</b></span>
    <form th:action="@{/logout}" method="post">
        <button type="submit" class="btn-secondary">로그아웃</button>
    </form>
</div>

<div class="admin-tabs">
    <a th:href="@{/admin/member/list}" class="btn-tab active">직원 관리</a>
    <a th:href="@{/admin/attendance/list}" class="btn-tab">근태 요청 관리</a>
    <a th:href="@{/admin/manage/list}" class="btn-tab ">관리자 설정</a>
    <a th:href="@{/admin/log/list}" class="btn-tab ">활동 로그</a>
</div>

<div class="admin-content">
    <h2> 직원 관리 시스템</h2>

    <div class="admin-controls">
        <form th:action="@{/admin/member/list}" method="get">
            <div class="flex-container">
                <div>
                    <strong> 검색:</strong>
                    <input type="text" name="userLoginId" th:value="${param.userLoginId}" placeholder="아이디"
                           style="padding:6px;">
                    <input type="text" name="userName" th:value="${param.userName}" placeholder="이름"
                           style="padding:6px;">
                </div>
                <div>
                    <strong> 부서:</strong>
                    <select name="deptId" style="padding:6px;">
                        <option value="">전체</option>
                        <option th:each="d : ${dept}" th:value="${d.deptId}" th:text="${d.deptName}"
                                th:selected="${#strings.equals(param.deptId, d.deptId)}"></option>
                    </select>
                </div>
                <div>
                    <strong> 상태:</strong>
                    <select name="userStatus" style="padding:6px;">
                        <option value="">전체</option>
                        <option value="ACTIVE" th:selected="${param.userStatus == 'ACTIVE'}">활성</option>
                        <option value="INACTIVE" th:selected="${param.userStatus == 'INACTIVE'}">비활성</option>
                        <option value="SUSPENDED" th:selected="${param.userStatus == 'SUSPENDED'}">정지</option>
                        <option value="BANNED" th:selected="${param.userStatus == 'BANNED'}">차단</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary"
                        style="background:#3182ce; color:white; border:none; padding:7px 20px; border-radius:4px; cursor:pointer;">조회</button>

                <button type="button" class="btn-reset-red"
                        th:onclick="|location.href='@{/admin/member/list}'|">검색필터 초기화
                </button>
            </div>
        </form>
    </div>


    <table>
        <thead>
        <tr>
            <th><input type="checkbox" id="checkAll" onclick="toggleAll(this)"></th>
            <th>아이디</th>
            <th>이름</th>
            <th>부서</th>
            <th>직급</th>
            <th>상태</th>
            <th>수정</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="u : ${user}">
            <td><input type="checkbox" name="userCheck" th:value="${u.userId}"></td>
            <td th:text="${u.userLoginId}">아이디</td>
            <td th:text="${u.userName}">이름</td>
            <td th:text="${u.deptName}">부서</td>
            <td th:text="${u.rankName}">직급</td>
            <td th:text="${u.userStatus}">상태</td>
            <td>
                <button class="btn-secondary"
                        th:onclick="openEditModal([[${u.userId}]], [[${u.deptId}]], [[${u.rankId}]], [[${u.userStatus}]])">
                    정보 변경
                </button>
            </td>
        </tr>
        </tbody>
    </table>

    <div style="display: flex; justify-content: space-between; margin-top: 20px; align-items: center;">
        <div>
            <strong> 선택 회원 상태 변경:</strong>
            <select id="batchStatus" style="padding:6px;">
                <option value="ACTIVE">활성(ACTIVE)</option>
                <option value="INACTIVE">비활성(INACTIVE)</option>
                <option value="SUSPENDED">정지(SUSPENDED)</option>
                <option value="BANNED">차단(BANNED)</option>
            </select>
            <button type="button" onclick="fnBatchUpdate()" class="btn-primary"
                    style="padding:7px 15px; cursor:pointer;">일괄 적용
            </button>
        </div>

        <div style="display: flex; gap: 8px;">
            <button onclick="openModal('deptAddModal')"
                    style="background:#2d3748; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">
                + 부서 관리
            </button>
            <button onclick="openModal('rankAddModal')"
                    style="background:#2d3748; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">
                + 직급 관리
            </button>
            <button onclick="openModal('adminAddModal')"
                    style="background:#38a169; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">
                + 관리자 생성
            </button>
        </div>
    </div>
</div>

<div id="editModal" class="modal">
    <div class="modal-content">
        <h3> 정보 수정</h3>
        <input type="hidden" id="targetUserId">
        <p><label>부서:</label> <select id="modalDept" style="width:100%; padding:8px;">
            <option th:each="d : ${dept}" th:value="${d.deptId}" th:text="${d.deptName}"></option>
        </select></p>
        <p><label>직급:</label> <select id="modalRank" style="width:100%; padding:8px;">
            <option th:each="r : ${rank}" th:value="${r.rankId}" th:text="${r.rankName}"></option>
        </select></p>
        <p><label>상태:</label> <select id="modalStatus" style="width:100%; padding:8px;">
            <option value="ACTIVE">ACTIVE (정상)</option>
            <option value="INACTIVE">INACTIVE (비활성)</option>
            <option value="SUSPENDED">SUSPENDED (정지)</option>
            <option value="BANNED">BANNED (차단)</option>
        </select></p>
        <div style="text-align: right; margin-top:20px;">
            <button onclick="saveChanges()" class="btn-primary" style="padding:8px 15px; cursor:pointer;">저장</button>
            <button onclick="closeModal('editModal')" class="btn-secondary" style="padding:8px 15px; cursor:pointer;">
                취소
            </button>
        </div>
    </div>
</div>

<div id="deptAddModal" class="modal">
    <div class="modal-content">
        <h3> 부서 관리</h3>
        <div style="margin-bottom:15px; padding-bottom:10px; border-bottom:1px solid #eee;">
            <input type="text" id="newDeptName" placeholder="새 부서명" style="width:70%; padding:8px;">
            <button onclick="fnAddDept()" class="btn-primary" style="padding:8px 12px; cursor:pointer;">추가</button>
        </div>
        <div style="max-height: 200px; overflow-y: auto;">
            <p th:each="d : ${dept}"
               style="display:flex; justify-content:space-between; align-items:center; margin:5px 0;">
                <span th:text="${d.deptName}">부서명</span>
                <button th:if="${d.deptId != 6}" class="btn-delete-small" th:onclick="fnDeleteDept([[${d.deptId}]])">
                    삭제
                </button>
            </p>
        </div>
        <div style="text-align: right; margin-top:15px;">
            <button onclick="closeModal('deptAddModal')" class="btn-secondary">닫기</button>
        </div>
    </div>
</div>

<div id="rankAddModal" class="modal">
    <div class="modal-content">
        <h3> 직급 관리</h3>
        <div style="margin-bottom:15px; padding-bottom:10px; border-bottom:1px solid #eee;">
            <input type="text" id="newRankName" placeholder="새 직급명" style="width:70%; padding:8px;">
            <button onclick="fnAddRank()" class="btn-primary" style="padding:8px 12px; cursor:pointer;">추가</button>
        </div>
        <div style="max-height: 200px; overflow-y: auto;">
            <p th:each="r : ${rank}"
               style="display:flex; justify-content:space-between; align-items:center; margin:5px 0;">
                <span th:text="${r.rankName}">직급명</span>
                <button th:if="${r.rankId != 6}" class="btn-delete-small" th:onclick="fnDeleteRank([[${r.rankId}]])">
                    삭제
                </button>
            </p>
        </div>
        <div style="text-align: right; margin-top:15px;">
            <button onclick="closeModal('rankAddModal')" class="btn-secondary">닫기</button>
        </div>
    </div>
</div>

<div id="adminAddModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0;"> 신규 관리자 생성</h3>
        <div style="text-align:left;">
            <label>이름</label>
            <input type="text" id="newAdminName"
                   style="width:100%; padding:8px; margin-bottom:10px; box-sizing:border-box;">
            <label>이메일(아이디)</label>
            <input type="email" id="newAdminEmail"
                   style="width:100%; padding:8px; margin-bottom:10px; box-sizing:border-box;">
            <label>비밀번호</label>
            <label>비밀번호</label>
            <div style="position:relative; margin-bottom:5px;">
                <input type="password" id="newAdminPassword" placeholder="8자리 이상, 특수문자 포함"
                       style="width:100%; padding:8px; padding-right:40px; box-sizing:border-box;">

                <i class="fa-solid fa-eye" id="togglePw" onclick="togglePasswordVisibility()"
                   style="position:absolute; right:12px; top:50%; transform:translateY(-50%); cursor:pointer; color: #718096; font-size: 16px;"></i>
            </div>
            <p id="pwGuide" style="font-size:11px; color:#666; margin-bottom:15px;">* 8자 이상, 영문/숫자/특수문자(@제외) 포함</p>
            <label>관리자 권한 설정</label>
            <select id="newAdminRoleId" style="width:100%; padding:8px; margin-bottom:15px;">
                <option value="">권한 선택</option>
                <option value="2">인사 관리자 (HR_MANAGER)</option>
                <option value="3">인사 담당자 (HR_STAFF)</option>
            </select>
        </div>
        <div style="text-align: right;">
            <button class="btn-primary" onclick="saveNewAdmin()"
                    style="background-color: #38a169; color:white; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">
                계정 생성
            </button>
            <button class="btn-secondary" onclick="closeModal('adminAddModal')"
                    style="padding:8px 15px; cursor:pointer; margin-left:5px;">취소
            </button>
        </div>
    </div>
</div>


<script src="/js/admin_user_list.js"></script>
</body>
</html>