<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì ì„¤ì •</title>
    <link rel="stylesheet" th:href="@{/css/admin_user_list.css}">
    <style>
        .status-active { color: #3182ce; font-weight: bold; }
        .status-suspended { color: #e53e3e; font-weight: bold; }
        .btn-tab { padding: 10px 20px; text-decoration: none; color: #666; border-bottom: 3px solid transparent; }
        .btn-tab.active { color: #3182ce; border-bottom: 3px solid #3182ce; font-weight: bold; }
        /* ê¶Œí•œ ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .role-badge { background: #e2e8f0; color: #4a5568; padding: 3px 8px; border-radius: 6px; font-size: 0.85em; font-weight: 600; }
    </style>
</head>
<body>

<div th:replace="~{members/admin_user_list :: .admin-header}"></div>

<div style="padding: 20px;">
    <div style="display: flex; gap: 20px; border-bottom: 1px solid #ddd; margin-bottom: 20px;">
        <a th:href="@{/admin/member/list}" class="btn-tab">ì§ì› ê´€ë¦¬</a>
        <a th:href="@{/admin/manage/list}" class="btn-tab active">ê´€ë¦¬ì ì„¤ì •</a>
        <a th:href="@{/admin/log/list}" class="btn-tab">í™œë™ ë¡œê·¸</a>
    </div>

    <h2>ğŸ‘¤ ì‹œìŠ¤í…œ ê´€ë¦¬ì ëª©ë¡</h2>
    <table>
        <thead>
        <tr>
            <th>ê´€ë¦¬ì ì´ë¦„</th>
            <th>ê¶Œí•œ(Role)</th>
            <th>ê¶Œí•œ ì„¤ëª…</th>
            <th>ì´ë©”ì¼(ì•„ì´ë””)</th>
            <th>ë§ˆì§€ë§‰ ì ‘ì† ì‹œê°„</th>
            <th>ìƒíƒœ</th>
            <th>ê³„ì • ì œì–´</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="a : ${admins}">
            <td><strong th:text="${a.adminName}">ê´€ë¦¬ìì´ë¦„</strong></td>

            <td>
                <span class="role-badge" th:text="${a.roleName}">SUPER_ADMIN</span>
            </td>

            <td>
                <span th:text="${a.roleDescription}" style="color: #718096; font-size: 0.9em;">ì„¤ëª… ë‚´ìš©</span>
            </td>

            <td th:text="${a.adminEmail}">admin@workneed.com</td>
            <td th:text="${a.adminLastLoginAt != null ? #temporals.format(a.adminLastLoginAt, 'yyyy-MM-dd HH:mm:ss') : 'ë¯¸ì ‘ì†'}"></td>
            <td>
                <span th:text="${a.adminStatus}"
                      th:class="${a.adminStatus == 'ACTIVE' ? 'status-active' : 'status-suspended'}">
                </span>
            </td>
            <td>
                <button th:if="${a.adminId != admin.adminId}"
                        th:class="${a.adminStatus == 'ACTIVE' ? 'btn-secondary' : 'btn-primary'}"
                        th:onclick="changeAdminStatus([[${a.adminId}]], [[${a.adminStatus}]])"
                        th:text="${a.adminStatus == 'ACTIVE' ? 'ê³„ì • ì •ì§€' : 'ì •ì§€ í•´ì œ'}">
                </button>
                <span th:if="${a.adminId == admin.adminId}" style="color: #999; font-size: 0.85em;">(ë³¸ì¸)</span>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    function changeAdminStatus(targetId, currentStatus) {
        const nextStatus = (currentStatus === 'ACTIVE') ? 'SUSPENDED' : 'ACTIVE';
        if(!confirm(`ê´€ë¦¬ì ìƒíƒœë¥¼ ${nextStatus}ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

        fetch('/admin/manage/status', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ targetId: targetId, status: nextStatus })
        }).then(res => res.text()).then(result => {
            if(result === "success") location.reload();
            else if(result === "self_error") alert("ë³¸ì¸ ê³„ì •ì€ ì •ì§€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            else alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        });
    }
</script>
</body>
</html>